<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NeonBill ‚Äì Smart Billing System</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;500;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&family=JetBrains+Mono:wght@400;500;700&display=swap" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}

:root{
  --bg-void:#05070f;
  --bg-deep:#080c18;
  --bg-card:#0b1022;
  --bg-raised:#0f1630;
  --bg-hover:#141c38;
  --c-cyan:#00e5ff;
  --c-cyan2:#00b8d4;
  --c-pink:#ff1a6c;
  --c-green:#00ff87;
  --c-purple:#c040fb;
  --c-amber:#ffab00;
  --c-blue:#448aff;
  --t-bright:#f0f4ff;
  --t-main:#c8d4f0;
  --t-muted:#5a6a8a;
  --t-dim:#3a4a68;
  --b-subtle:rgba(0,229,255,0.08);
  --b-soft:rgba(0,229,255,0.18);
  --glow-cyan:0 0 24px rgba(0,229,255,0.22),0 0 48px rgba(0,229,255,0.08);
  --font-display:'Syne',sans-serif;
  --font-body:'DM Sans',sans-serif;
  --font-mono:'JetBrains Mono',monospace;
  --radius:14px;
  --radius-sm:8px;
  --ease:cubic-bezier(.4,0,.2,1);
  --speed:220ms;
}

html{font-size:16px;-webkit-font-smoothing:antialiased;}
body{
  background:var(--bg-void);
  color:var(--t-main);
  font-family:var(--font-body);
  font-weight:400;
  min-height:100vh;
  overflow-x:hidden;
  line-height:1.6;
}

::-webkit-scrollbar{width:5px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:rgba(0,229,255,0.25);border-radius:3px;}

/* BG layers */
.bg-layer{position:fixed;inset:0;pointer-events:none;z-index:0;overflow:hidden;}
.bg-grid{
  position:absolute;inset:0;
  background-image:linear-gradient(rgba(0,229,255,0.025) 1px,transparent 1px),linear-gradient(90deg,rgba(0,229,255,0.025) 1px,transparent 1px);
  background-size:50px 50px;
  mask-image:radial-gradient(ellipse 80% 80% at 50% 50%,black 30%,transparent 100%);
}
.bg-orb1{position:absolute;top:-30%;right:-15%;width:700px;height:700px;border-radius:50%;background:radial-gradient(circle,rgba(0,229,255,0.055) 0%,transparent 65%);}
.bg-orb2{position:absolute;bottom:-20%;left:-10%;width:500px;height:500px;border-radius:50%;background:radial-gradient(circle,rgba(192,64,251,0.04) 0%,transparent 65%);}
.bg-orb3{position:absolute;top:40%;left:35%;width:300px;height:300px;border-radius:50%;background:radial-gradient(circle,rgba(255,26,108,0.025) 0%,transparent 65%);}

/* Layout */
#app{position:relative;z-index:1;display:flex;height:100vh;}

/* SIDEBAR */
#sidebar{
  width:252px;min-width:252px;
  background:var(--bg-card);border-right:1px solid var(--b-subtle);
  display:flex;flex-direction:column;position:relative;overflow:hidden;
  transition:width var(--speed) var(--ease);
}
#sidebar::after{
  content:'';position:absolute;top:0;left:0;width:1px;height:100%;
  background:linear-gradient(180deg,transparent,var(--c-cyan) 40%,var(--c-purple) 70%,transparent);
  opacity:0.35;animation:sbarPulse 4s ease-in-out infinite;
}
@keyframes sbarPulse{0%,100%{opacity:.2;}50%{opacity:.5;}}

.s-logo{padding:26px 20px 22px;border-bottom:1px solid var(--b-subtle);}
.s-logo-mark{display:flex;align-items:center;gap:10px;margin-bottom:4px;}
.s-bolt{font-size:1.5rem;filter:drop-shadow(0 0 8px var(--c-cyan));animation:boltP 2.5s ease-in-out infinite;}
@keyframes boltP{0%,100%{filter:drop-shadow(0 0 6px var(--c-cyan));}50%{filter:drop-shadow(0 0 18px var(--c-cyan));}}
.s-wordmark{font-family:var(--font-display);font-size:1.25rem;font-weight:800;letter-spacing:3px;background:linear-gradient(135deg,var(--c-cyan),var(--c-purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-transform:uppercase;}
.s-tagline{font-size:.65rem;color:var(--t-muted);letter-spacing:1.5px;font-family:var(--font-mono);}

.shop-badge{margin:12px 14px;padding:11px 14px;background:rgba(0,229,255,0.04);border:1px solid var(--b-subtle);border-radius:var(--radius-sm);cursor:pointer;transition:all var(--speed) var(--ease);}
.shop-badge:hover{background:rgba(0,229,255,0.09);border-color:var(--b-soft);}
.shop-badge-lbl{font-size:.65rem;color:var(--t-muted);letter-spacing:1.5px;text-transform:uppercase;font-family:var(--font-mono);margin-bottom:3px;}
.shop-badge-name{font-family:var(--font-display);font-size:.92rem;font-weight:700;color:var(--c-cyan);word-break:break-word;}
.shop-badge-type{font-size:.72rem;color:var(--t-muted);margin-top:1px;}

nav{flex:1;padding:6px 0;overflow-y:auto;}
.nav-section{padding:14px 18px 5px;font-size:.6rem;letter-spacing:2.5px;text-transform:uppercase;color:var(--t-dim);font-family:var(--font-mono);}
.nav-item{display:flex;align-items:center;gap:11px;padding:10px 18px;cursor:pointer;transition:all var(--speed) var(--ease);font-size:.875rem;color:var(--t-muted);font-family:var(--font-body);font-weight:500;position:relative;border-left:2px solid transparent;user-select:none;}
.nav-item:hover{background:var(--bg-hover);color:var(--t-bright);}
.nav-item.active{background:rgba(0,229,255,0.07);color:var(--c-cyan);border-left-color:var(--c-cyan);}
.nav-item.active::after{content:'';position:absolute;right:0;top:25%;bottom:25%;width:2px;background:var(--c-cyan);border-radius:2px 0 0 2px;box-shadow:0 0 8px var(--c-cyan);}
.nav-icon{font-size:1rem;width:20px;text-align:center;flex-shrink:0;}
.nav-label{flex:1;}
.nav-key{font-family:var(--font-mono);font-size:.6rem;background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);border-radius:4px;padding:2px 6px;color:var(--t-dim);transition:color var(--speed);}
.nav-item.active .nav-key{color:rgba(0,229,255,0.6);border-color:rgba(0,229,255,0.2);}

.s-footer{padding:12px 18px;border-top:1px solid var(--b-subtle);font-size:.72rem;color:var(--t-dim);font-family:var(--font-mono);}
kbd{background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);border-radius:3px;padding:1px 5px;font-size:.68rem;color:var(--t-muted);font-family:var(--font-mono);}

/* MAIN */
#main{flex:1;overflow-y:auto;display:flex;flex-direction:column;}

/* PAGES */
.page{display:none;flex:1;flex-direction:column;padding:28px;gap:22px;animation:pageIn .3s var(--ease);}
.page.active{display:flex;}
@keyframes pageIn{from{opacity:0;transform:translateY(14px);}to{opacity:1;transform:none;}}

.page-hdr{display:flex;justify-content:space-between;align-items:flex-start;flex-wrap:wrap;gap:14px;}
.page-title{font-family:var(--font-display);font-size:1.75rem;font-weight:800;letter-spacing:-0.5px;color:var(--t-bright);line-height:1.1;}
.page-sub{font-size:.82rem;color:var(--t-muted);margin-top:4px;font-weight:300;font-style:italic;}
.page-actions{display:flex;gap:10px;flex-wrap:wrap;align-items:center;}

/* Typography */
.txt-cyan{color:var(--c-cyan);text-shadow:0 0 20px rgba(0,229,255,.5);}
.txt-pink{color:var(--c-pink);text-shadow:0 0 20px rgba(255,26,108,.5);}
.txt-green{color:var(--c-green);text-shadow:0 0 20px rgba(0,255,135,.5);}
.txt-amber{color:var(--c-amber);}
.txt-purple{color:var(--c-purple);}
.mono{font-family:var(--font-mono);}

/* CARDS */
.card{background:var(--bg-card);border:1px solid var(--b-subtle);border-radius:var(--radius);padding:22px;transition:border-color var(--speed),box-shadow var(--speed);}
.card:hover{border-color:var(--b-soft);box-shadow:var(--glow-cyan);}
.card-ttl{font-family:var(--font-display);font-size:.72rem;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--t-muted);margin-bottom:18px;display:flex;align-items:center;gap:8px;}
.pip{width:5px;height:5px;border-radius:50%;background:var(--c-cyan);box-shadow:0 0 8px var(--c-cyan);flex-shrink:0;}
.pip.pink{background:var(--c-pink);box-shadow:0 0 8px var(--c-pink);}
.pip.green{background:var(--c-green);box-shadow:0 0 8px var(--c-green);}
.pip.amber{background:var(--c-amber);box-shadow:0 0 8px var(--c-amber);}
.pip.purple{background:var(--c-purple);box-shadow:0 0 8px var(--c-purple);}

/* STATS */
.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:14px;}
.stat-card{background:var(--bg-card);border-radius:var(--radius);padding:22px;border:1px solid var(--b-subtle);position:relative;overflow:hidden;transition:all var(--speed) var(--ease);}
.stat-card::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse at 80% 20%,currentColor,transparent 60%);opacity:0.04;}
.stat-card::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;}
.stat-card.c{color:var(--c-cyan);}  .stat-card.c::after{background:var(--c-cyan);box-shadow:0 0 14px var(--c-cyan);}
.stat-card.p{color:var(--c-pink);}  .stat-card.p::after{background:var(--c-pink);box-shadow:0 0 14px var(--c-pink);}
.stat-card.g{color:var(--c-green);} .stat-card.g::after{background:var(--c-green);box-shadow:0 0 14px var(--c-green);}
.stat-card.a{color:var(--c-amber);} .stat-card.a::after{background:var(--c-amber);box-shadow:0 0 14px var(--c-amber);}
.stat-card:hover{transform:translateY(-3px);box-shadow:var(--glow-cyan);}
.stat-icon{font-size:1.6rem;margin-bottom:10px;display:block;}
.stat-val{font-family:var(--font-display);font-size:1.8rem;font-weight:800;line-height:1;color:currentColor;}
.stat-lbl{font-size:.75rem;color:var(--t-muted);margin-top:6px;}

/* FORMS */
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:14px;}
.form-group{display:flex;flex-direction:column;gap:6px;}
.form-lbl{font-size:.72rem;font-weight:600;color:var(--t-muted);letter-spacing:.8px;text-transform:uppercase;font-family:var(--font-mono);}
.req{color:var(--c-pink);}
.form-ctrl{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius-sm);color:var(--t-bright);padding:10px 14px;font-size:.9rem;font-family:var(--font-body);transition:all var(--speed) var(--ease);outline:none;width:100%;}
.form-ctrl:focus{border-color:var(--c-cyan);box-shadow:0 0 0 3px rgba(0,229,255,.1),0 0 16px rgba(0,229,255,.07);background:rgba(0,229,255,.03);}
.form-ctrl::placeholder{color:rgba(255,255,255,0.18);}
select.form-ctrl option{background:var(--bg-raised);color:var(--t-bright);}

/* BUTTONS */
.btn{display:inline-flex;align-items:center;justify-content:center;gap:7px;padding:9px 20px;border-radius:var(--radius-sm);font-size:.85rem;font-weight:600;cursor:pointer;border:none;outline:none;transition:all var(--speed) var(--ease);user-select:none;white-space:nowrap;font-family:var(--font-body);letter-spacing:.2px;}
.btn-sm{padding:6px 13px;font-size:.78rem;}
.btn-lg{padding:13px 30px;font-size:1rem;}
.btn-primary{background:linear-gradient(135deg,var(--c-cyan),var(--c-blue));color:#000;font-weight:700;box-shadow:0 0 20px rgba(0,229,255,.3);}
.btn-primary:hover{box-shadow:0 0 32px rgba(0,229,255,.5);transform:translateY(-1px);}
.btn-danger{background:linear-gradient(135deg,var(--c-pink),#a8003e);color:#fff;box-shadow:0 0 18px rgba(255,26,108,.22);}
.btn-danger:hover{box-shadow:0 0 28px rgba(255,26,108,.45);transform:translateY(-1px);}
.btn-success{background:linear-gradient(135deg,var(--c-green),#00a85a);color:#000;font-weight:700;box-shadow:0 0 18px rgba(0,255,135,.22);}
.btn-success:hover{box-shadow:0 0 28px rgba(0,255,135,.45);transform:translateY(-1px);}
.btn-ghost{background:transparent;color:var(--t-main);border:1px solid rgba(255,255,255,0.1);}
.btn-ghost:hover{background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,.22);}
.btn-amber{background:linear-gradient(135deg,var(--c-amber),#b37700);color:#000;font-weight:700;box-shadow:0 0 18px rgba(255,171,0,.22);}
.btn-amber:hover{box-shadow:0 0 28px rgba(255,171,0,.45);transform:translateY(-1px);}
.btn-purple{background:linear-gradient(135deg,var(--c-purple),#7b00cc);color:#fff;box-shadow:0 0 18px rgba(192,64,251,.22);}
.btn-purple:hover{box-shadow:0 0 28px rgba(192,64,251,.45);transform:translateY(-1px);}

/* BADGES */
.badge{display:inline-block;padding:3px 10px;border-radius:20px;font-size:.68rem;font-weight:700;letter-spacing:.6px;font-family:var(--font-mono);}
.bdg-c{background:rgba(0,229,255,.12);color:var(--c-cyan);border:1px solid rgba(0,229,255,.25);}
.bdg-p{background:rgba(255,26,108,.12);color:var(--c-pink);border:1px solid rgba(255,26,108,.25);}
.bdg-g{background:rgba(0,255,135,.1);color:var(--c-green);border:1px solid rgba(0,255,135,.25);}
.bdg-a{background:rgba(255,171,0,.12);color:var(--c-amber);border:1px solid rgba(255,171,0,.25);}
.bdg-pu{background:rgba(192,64,251,.12);color:var(--c-purple);border:1px solid rgba(192,64,251,.25);}

/* Stock badges */
.stock-ok{color:var(--c-green);font-weight:700;}
.stock-low{color:var(--c-amber);font-weight:700;}
.stock-out{color:var(--c-pink);font-weight:700;}

/* Stock notification bar */
.stock-notif{
  background:linear-gradient(135deg,rgba(255,26,108,.08),rgba(255,171,0,.08));
  border:1px solid rgba(255,26,108,.25);
  border-radius:var(--radius);padding:14px 18px;
  display:flex;align-items:center;gap:12px;
  animation:slideDown .3s var(--ease);
}
@keyframes slideDown{from{transform:translateY(-10px);opacity:0;}to{transform:none;opacity:1;}}
.stock-notif-icon{font-size:1.3rem;flex-shrink:0;}
.stock-notif-content{flex:1;}
.stock-notif-title{font-family:var(--font-display);font-size:.85rem;font-weight:700;color:var(--c-pink);margin-bottom:2px;}
.stock-notif-msg{font-size:.75rem;color:var(--t-muted);}

.hr{height:1px;background:rgba(255,255,255,0.05);margin:10px 0;}

/* TABLE */
.tbl-wrap{overflow-x:auto;border-radius:var(--radius-sm);}
table{width:100%;border-collapse:collapse;}
thead tr{background:rgba(0,229,255,0.04);}
th{padding:10px 14px;text-align:left;font-size:.65rem;text-transform:uppercase;letter-spacing:2px;color:var(--c-cyan);font-weight:700;white-space:nowrap;border-bottom:1px solid rgba(0,229,255,0.12);font-family:var(--font-mono);}
td{padding:11px 14px;font-size:.875rem;border-bottom:1px solid rgba(255,255,255,0.04);vertical-align:middle;color:var(--t-main);}
tbody tr{transition:background var(--speed);}
tbody tr:hover{background:rgba(0,229,255,.025);}
tbody tr:last-child td{border-bottom:none;}
.td-bold{font-weight:600;color:var(--t-bright);}
.td-del{cursor:pointer;color:var(--c-pink);font-size:.9rem;transition:all var(--speed);padding:4px 8px;border-radius:4px;}
.td-del:hover{background:rgba(255,26,108,.12);transform:scale(1.15);text-shadow:0 0 10px var(--c-pink);}
.qty-ctrl{display:flex;align-items:center;gap:7px;}
.qty-btn{width:26px;height:26px;border-radius:50%;border:1px solid rgba(255,255,255,0.1);background:rgba(255,255,255,.05);color:var(--t-main);cursor:pointer;font-size:.9rem;font-weight:700;transition:all var(--speed);display:flex;align-items:center;justify-content:center;}
.qty-btn:hover{background:rgba(0,229,255,.15);border-color:var(--c-cyan);color:var(--c-cyan);}
.qty-num{font-family:var(--font-mono);font-size:.85rem;min-width:18px;text-align:center;}

/* SETUP */
#setup-overlay{position:fixed;inset:0;z-index:999;background:var(--bg-void);display:flex;align-items:center;justify-content:center;padding:20px;animation:pageIn .4s var(--ease);}
.setup-box{width:100%;max-width:500px;background:var(--bg-card);border:1px solid rgba(0,229,255,.2);border-radius:22px;padding:44px 40px;box-shadow:0 0 80px rgba(0,229,255,.07),0 0 160px rgba(192,64,251,.05),0 40px 80px rgba(0,0,0,.4);position:relative;overflow:hidden;}
.setup-box::before{content:'';position:absolute;top:-40px;right:-40px;width:200px;height:200px;border-radius:50%;background:radial-gradient(circle,rgba(0,229,255,.06),transparent 70%);pointer-events:none;}
.setup-logo{text-align:center;margin-bottom:36px;}
.setup-bigbolt{font-size:3rem;display:block;margin-bottom:10px;filter:drop-shadow(0 0 20px var(--c-cyan));animation:boltP 2s ease-in-out infinite;}
.setup-wordmark{font-family:var(--font-display);font-size:2.2rem;font-weight:800;letter-spacing:4px;text-transform:uppercase;background:linear-gradient(135deg,var(--c-cyan),var(--c-purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent;line-height:1.1;}
.setup-sub{color:var(--t-muted);font-size:.82rem;margin-top:7px;font-style:italic;font-weight:300;}
.setup-heading{font-family:var(--font-display);font-size:1rem;font-weight:700;color:var(--t-muted);margin-bottom:22px;letter-spacing:.5px;}

/* BILLING */
.billing-layout{display:grid;grid-template-columns:1fr 360px;gap:20px;align-items:start;}
@media(max-width:1060px){.billing-layout{grid-template-columns:1fr;}}

.item-entry-row{display:grid;grid-template-columns:2fr 80px 1fr 1fr auto;gap:10px;align-items:end;margin-bottom:14px;}
@media(max-width:720px){.item-entry-row{grid-template-columns:1fr 1fr;}}

.hint-bar{display:flex;flex-wrap:wrap;gap:6px;margin-top:10px;}
.hint{display:inline-flex;align-items:center;gap:5px;background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.06);border-radius:5px;padding:3px 9px;font-size:.68rem;color:var(--t-dim);font-family:var(--font-mono);}

/* SUMMARY */
.summary-panel{background:var(--bg-card);border:1px solid rgba(0,229,255,.15);border-radius:var(--radius);padding:22px;position:sticky;top:20px;box-shadow:0 0 40px rgba(0,229,255,.05);}
.sum-row{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:.88rem;}
.sum-row:last-of-type{border-bottom:none;}
.sum-row.total-row{font-family:var(--font-display);font-size:1.15rem;font-weight:800;color:var(--c-cyan);margin-top:6px;text-shadow:0 0 18px rgba(0,229,255,.4);}
.sum-val{font-weight:700;font-family:var(--font-mono);}
.sum-row.disc .sum-val{color:var(--c-green);}
.sum-row.gst .sum-val{color:var(--c-amber);}
.inline-row{display:flex;align-items:center;justify-content:space-between;gap:8px;padding:5px 0;}
.inline-row label{font-size:.78rem;color:var(--t-muted);white-space:nowrap;font-family:var(--font-mono);}
.inline-ctrl{display:flex;gap:6px;align-items:center;}
.inline-ctrl .form-ctrl{max-width:90px;padding:6px 10px;font-size:.82rem;}

/* GST */
.gst-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px;}
@media(max-width:760px){.gst-grid{grid-template-columns:1fr;}}
.gst-purchase-row{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:10px;align-items:end;margin-bottom:12px;}
@media(max-width:640px){.gst-purchase-row{grid-template-columns:1fr 1fr;}}
.gst-settle{background:linear-gradient(135deg,rgba(192,64,251,.05),rgba(0,229,255,.03));border:1px solid rgba(192,64,251,.18);border-radius:var(--radius);padding:22px;}
.gst-settle-ttl{font-family:var(--font-display);font-size:.7rem;letter-spacing:2.5px;text-transform:uppercase;color:var(--c-purple);margin-bottom:16px;font-weight:700;}
.gst-ln{display:flex;justify-content:space-between;align-items:center;padding:9px 0;border-bottom:1px solid rgba(255,255,255,0.04);font-size:.88rem;}
.gst-ln:last-of-type{border-bottom:none;}
.gst-ln.final{font-family:var(--font-display);font-size:1rem;font-weight:800;border-top:2px solid rgba(192,64,251,.25);border-bottom:none;margin-top:8px;padding-top:14px;color:var(--c-purple);text-shadow:0 0 14px rgba(192,64,251,.5);}
.pos{color:var(--c-green);font-weight:700;font-family:var(--font-mono);}
.neg{color:var(--c-pink);font-weight:700;font-family:var(--font-mono);}
.neu{color:var(--c-amber);font-weight:700;font-family:var(--font-mono);}

/* HISTORY */
.hist-item{background:var(--bg-card);border:1px solid var(--b-subtle);border-radius:var(--radius);padding:16px 20px;cursor:pointer;transition:all var(--speed) var(--ease);display:flex;justify-content:space-between;align-items:center;gap:12px;}
.hist-item:hover{border-color:rgba(0,229,255,.32);box-shadow:var(--glow-cyan);transform:translateX(4px);}
.hist-meta h4{font-family:var(--font-display);font-size:.95rem;font-weight:700;color:var(--t-bright);margin-bottom:3px;}
.hist-meta p{font-size:.75rem;color:var(--t-muted);}
.hist-amt{text-align:right;}
.hist-amt .amt{font-family:var(--font-display);font-size:1.15rem;font-weight:800;color:var(--c-cyan);}
.hist-amt .dt{font-size:.7rem;color:var(--t-muted);margin-top:2px;font-family:var(--font-mono);}

/* MODAL */
.modal-overlay{position:fixed;inset:0;z-index:800;background:rgba(0,0,0,.75);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;padding:20px;animation:fadeO .2s var(--ease);}
@keyframes fadeO{from{opacity:0;}to{opacity:1;}}
.modal{background:var(--bg-card);border:1px solid rgba(0,229,255,.25);border-radius:22px;padding:34px;width:100%;max-width:460px;box-shadow:0 0 70px rgba(0,229,255,.09),0 40px 80px rgba(0,0,0,.5);animation:modalS .25s var(--ease);}
@keyframes modalS{from{transform:translateY(28px);opacity:0;}to{transform:none;opacity:1;}}
.modal h3{font-family:var(--font-display);font-size:1.25rem;font-weight:800;color:var(--t-bright);margin-bottom:5px;}
.modal p{color:var(--t-muted);font-size:.85rem;margin-bottom:24px;font-style:italic;font-weight:300;}
.modal-footer{display:flex;gap:12px;justify-content:flex-end;margin-top:26px;flex-wrap:wrap;}

/* CATALOG */
.catalog-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;max-height:340px;overflow-y:auto;margin-bottom:16px;padding-right:2px;}
.cat-item{background:rgba(255,255,255,0.03);border:1px solid rgba(255,255,255,0.07);border-radius:var(--radius-sm);padding:14px 10px;cursor:pointer;text-align:center;transition:all var(--speed) var(--ease);}
.cat-item:hover{background:rgba(0,229,255,.07);border-color:var(--c-cyan);transform:translateY(-2px);}
.ci-icon{font-size:1.8rem;margin-bottom:6px;}
.ci-name{font-size:.78rem;color:var(--t-main);font-weight:500;line-height:1.3;}
.ci-price{font-size:.72rem;color:var(--c-cyan);font-weight:700;font-family:var(--font-mono);margin-top:3px;}

/* TOAST */
#toast-wrap{position:fixed;bottom:24px;right:24px;z-index:9999;display:flex;flex-direction:column-reverse;gap:8px;}
.toast{background:var(--bg-raised);border:1px solid rgba(255,255,255,0.09);border-radius:var(--radius-sm);padding:12px 18px;font-size:.84rem;min-width:230px;max-width:330px;display:flex;align-items:center;gap:10px;box-shadow:0 8px 36px rgba(0,0,0,.45);animation:toastI .28s var(--ease);font-family:var(--font-body);color:var(--t-main);}
@keyframes toastI{from{transform:translateX(40px);opacity:0;}to{transform:none;opacity:1;}}
.toast.ok{border-left:3px solid var(--c-green);}
.toast.err{border-left:3px solid var(--c-pink);}
.toast.inf{border-left:3px solid var(--c-cyan);}

/* Empty state */
.empty-state{text-align:center;padding:36px 20px;color:var(--t-muted);font-style:italic;font-size:.88rem;}
.empty-icon{font-size:2.3rem;display:block;margin-bottom:10px;opacity:.4;}

/* RESPONSIVE */
@media(max-width:768px){
  #sidebar{width:58px;min-width:58px;}
  .s-logo{padding:14px 8px;text-align:center;}
  .s-bolt{font-size:1.3rem;margin:0;}
  .s-wordmark,.s-tagline,.shop-badge,.nav-section,.nav-label,.nav-key,.s-footer{display:none;}
  .nav-item{padding:14px;justify-content:center;}
  .nav-item.active::after{display:none;}
  .page{padding:14px;gap:14px;}
}
@media(max-width:480px){
  .page-title{font-size:1.4rem;}
  .form-grid{grid-template-columns:1fr;}
  .setup-box{padding:28px 22px;}
}
</style>
</head>
<body>
<div class="bg-layer">
  <div class="bg-grid"></div>
  <div class="bg-orb1"></div>
  <div class="bg-orb2"></div>
  <div class="bg-orb3"></div>
</div>

<!-- SETUP -->
<div id="setup-overlay">
  <div class="setup-box">
    <div class="setup-logo">
      <span class="setup-bigbolt">‚ö°</span>
      <div class="setup-wordmark">NeonBill</div>
      <div class="setup-sub">Smart billing for modern businesses</div>
    </div>
    <div class="setup-heading">Configure your shop to get started</div>
    <div style="display:flex;flex-direction:column;gap:14px;">
      <div class="form-group">
        <label class="form-lbl">Shop Name <span class="req">*</span></label>
        <input id="su-name" class="form-ctrl" placeholder="e.g. Green Valley Grocery" maxlength="60"/>
        <p style="font-size:.7rem;color:var(--t-muted);margin-top:4px;">Enter existing shop name to login, or new name to create account</p>
      </div>
      </div>
      <div class="form-group">
        <label class="form-lbl">Business Type <span class="req">*</span></label>
        <select id="su-type" class="form-ctrl">
          <option value="">‚Äî Select your business type ‚Äî</option>
          <option>üõí Grocery Store</option><option>üçΩÔ∏è Restaurant</option>
          <option>‚òï Caf√©</option><option>ü•ê Bakery</option>
          <option>üíä Pharmacy</option><option>üì± Electronics</option>
          <option>üëï Clothing</option><option>üè™ General Store</option>
          <option>üçï Fast Food</option><option>üß¥ Cosmetics</option>
        </select>
      </div>
      <div class="form-grid" style="grid-template-columns:1fr 1fr;gap:12px;">
        <div class="form-group">
          <label class="form-lbl">GSTIN <span style="color:var(--t-dim)">(opt)</span></label>
          <input id="su-gst" class="form-ctrl" placeholder="22AAAAA0000A1Z5" maxlength="15"/>
        </div>
        <div class="form-group">
          <label class="form-lbl">Phone <span style="color:var(--t-dim)">(opt)</span></label>
          <input id="su-phone" class="form-ctrl" placeholder="+91 XXXXX XXXXX"/>
        </div>
      </div>
      <div class="form-group">
        <label class="form-lbl">Address <span style="color:var(--t-dim)">(opt)</span></label>
        <input id="su-addr" class="form-ctrl" placeholder="123, Main Street, City"/>
      </div>
      <button class="btn btn-primary btn-lg" style="width:100%;margin-top:8px;" onclick="doSetup()">‚ö° Launch NeonBill</button>
    </div>
  </div>
</div>

<!-- APP -->
<div id="app">
  <aside id="sidebar">
    <div class="s-logo">
      <div class="s-logo-mark">
        <span class="s-bolt">‚ö°</span>
        <span class="s-wordmark">NeonBill</span>
      </div>
      <div class="s-tagline">Smart Billing System</div>
    </div>
    <div class="shop-badge" onclick="openShopModal()">
      <div class="shop-badge-lbl">Active Shop</div>
      <div class="shop-badge-name" id="sb-name">‚Äî</div>
      <div class="shop-badge-type" id="sb-type">‚Äî</div>
    </div>
    <nav>
      <div class="nav-section">Navigation</div>
      <div class="nav-item active" data-page="dashboard" onclick="goTo('dashboard')"><span class="nav-icon">üè†</span><span class="nav-label">Dashboard</span><span class="nav-key">Alt 1</span></div>
      <div class="nav-item" data-page="billing" onclick="goTo('billing')"><span class="nav-icon">üßæ</span><span class="nav-label">Billing</span><span class="nav-key">Alt 2</span></div>
      <div class="nav-item" data-page="inventory" onclick="goTo('inventory')"><span class="nav-icon">üì¶</span><span class="nav-label">Inventory</span><span class="nav-key">Alt 3</span></div>
      <div class="nav-item" data-page="gst" onclick="goTo('gst')"><span class="nav-icon">üìä</span><span class="nav-label">GST Portal</span><span class="nav-key">Alt 4</span></div>
      <div class="nav-item" data-page="history" onclick="goTo('history')"><span class="nav-icon">üïí</span><span class="nav-label">History</span><span class="nav-key">Alt 5</span></div>
      <div class="nav-item" data-page="settings" onclick="goTo('settings')"><span class="nav-icon">‚öôÔ∏è</span><span class="nav-label">Settings</span><span class="nav-key">Alt 6</span></div>
    </nav>
    <div class="s-footer">
      <button class="btn btn-danger btn-sm" id="logout-user" style="width:100%;justify-content:center;font-size:.75rem;padding:8px;" onclick="logout()">üö™ Logout</button>
      <div style="margin-top:8px;font-size:.7rem;text-align:center;"><kbd>Alt</kbd> + <kbd>1‚Äì6</kbd> &nbsp;switch pages</div>
    </div>
  </aside>

  <main id="main">

    <!-- DASHBOARD -->
    <section id="page-dashboard" class="page active">
      <div class="page-hdr">
        <div><div class="page-title">Dashboard <span class="txt-cyan">‚Üó</span></div><div class="page-sub">Your business at a glance ‚Äî today's snapshot</div></div>
        <div class="page-actions"><button class="btn btn-primary" onclick="goTo('billing')">‚ûï New Bill</button></div>
      </div>
      
      <!-- Stock Alerts -->
      <div id="stock-alerts"></div>
      
      <div class="stats-grid">
        <div class="stat-card c"><span class="stat-icon">üßæ</span><div class="stat-val" id="st-bills">0</div><div class="stat-lbl">Bills Today</div></div>
        <div class="stat-card p"><span class="stat-icon">üí∞</span><div class="stat-val" id="st-rev">‚Çπ0</div><div class="stat-lbl">Revenue Today</div></div>
        <div class="stat-card g"><span class="stat-icon">üè∑Ô∏è</span><div class="stat-val" id="st-gst">‚Çπ0</div><div class="stat-lbl">GST Collected</div></div>
        <div class="stat-card a"><span class="stat-icon">üéÅ</span><div class="stat-val" id="st-disc">‚Çπ0</div><div class="stat-lbl">Discounts Given</div></div>
      </div>
      <div class="card">
        <div class="card-ttl"><span class="pip"></span>Recent Bills</div>
        <div id="dash-recent"><div class="empty-state"><span class="empty-icon">üßæ</span>No bills yet. <a href="#" style="color:var(--c-cyan)" onclick="goTo('billing')">Create your first ‚Üí</a></div></div>
      </div>
    </section>

    <!-- BILLING -->
    <section id="page-billing" class="page">
      <div class="page-hdr">
        <div><div class="page-title">New Bill <span class="txt-cyan">üßæ</span></div><div class="page-sub" id="billing-shop-sub">‚Äî</div></div>
        <div class="page-actions">
          <span class="badge bdg-c mono">Bill #<span id="bill-num">0001</span></span>
          <button class="btn btn-ghost btn-sm" onclick="openCatalog()">üìã Catalog <kbd>C</kbd></button>
          <button class="btn btn-danger btn-sm" onclick="clearBill()">üóë Clear <kbd>Esc</kbd></button>
          <button class="btn btn-success" onclick="finalizeBill()">‚úÖ Finalize <kbd>‚Üµ</kbd></button>
        </div>
      </div>
      <div class="billing-layout">
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div class="card">
            <div class="card-ttl"><span class="pip"></span>Add Item</div>
            <div class="item-entry-row">
              <div class="form-group">
                <label class="form-lbl">Item Name <span class="req">*</span></label>
                <input id="b-name" class="form-ctrl" placeholder="Product or dish name" list="inv-dl" autocomplete="off"/>
                <datalist id="inv-dl"></datalist>
              </div>
              <div class="form-group">
                <label class="form-lbl">Qty</label>
                <input id="b-qty" class="form-ctrl" type="number" min="1" value="1"/>
              </div>
              <div class="form-group">
                <label class="form-lbl">Unit Price ‚Çπ</label>
                <input id="b-price" class="form-ctrl" type="number" min="0" step="0.01" placeholder="0.00"/>
              </div>
              <div class="form-group">
                <label class="form-lbl">GST %</label>
                <select id="b-gst" class="form-ctrl">
                  <option value="0">0%</option><option value="5">5%</option>
                  <option value="12">12%</option><option value="18" selected>18%</option>
                  <option value="28">28%</option>
                </select>
              </div>
              <div class="form-group">
                <label class="form-lbl" style="opacity:0">‚Äî</label>
                <button class="btn btn-primary" onclick="addItem()" style="height:42px;padding:0 18px;">‚ûï Add</button>
              </div>
            </div>
            <div class="hint-bar">
              <span class="hint"><kbd>Tab</kbd> navigate</span>
              <span class="hint"><kbd>‚Üµ</kbd> add item</span>
              <span class="hint"><kbd>C</kbd> catalog</span>
              <span class="hint"><kbd>Esc</kbd> clear bill</span>
            </div>
          </div>
          <div class="card" style="padding:0;overflow:hidden;">
            <div class="tbl-wrap">
              <table>
                <thead><tr><th>#</th><th>Item</th><th>Qty</th><th>Unit ‚Çπ</th><th>GST%</th><th>GST ‚Çπ</th><th>Total ‚Çπ</th><th></th></tr></thead>
                <tbody id="bill-body"><tr><td colspan="8" class="empty-state"><span class="empty-icon">üõí</span>Add items above to start billing</td></tr></tbody>
              </table>
            </div>
          </div>
        </div>
        <div>
          <div class="summary-panel">
            <div class="card-ttl" style="margin-bottom:14px;"><span class="pip"></span>Summary</div>
            <div class="sum-row"><span>Subtotal</span><span class="sum-val" id="s-sub">‚Çπ0.00</span></div>
            <div class="sum-row gst"><span>GST</span><span class="sum-val txt-amber" id="s-gst">‚Çπ0.00</span></div>
            <div class="sum-row disc"><span>Discount</span><span class="sum-val">‚àí&nbsp;‚Çπ<span id="s-disc">0.00</span></span></div>
            <div class="hr"></div>
            <div class="sum-row total-row"><span>Grand Total</span><span class="sum-val" id="s-total">‚Çπ0.00</span></div>
            <div class="hr"></div>
            <div class="inline-row">
              <label>Discount</label>
              <div class="inline-ctrl">
                <input id="disc-val" class="form-ctrl" type="number" min="0" step="0.01" value="0" style="max-width:88px;padding:6px 10px;font-size:.82rem;" oninput="recalc()"/>
                <select id="disc-type" class="form-ctrl" style="max-width:60px;padding:6px 8px;font-size:.82rem;" onchange="recalc()">
                  <option value="flat">‚Çπ</option><option value="pct">%</option>
                </select>
              </div>
            </div>
            <div class="inline-row">
              <label>Payment</label>
              <select id="pay-mode" class="form-ctrl" style="max-width:145px;padding:6px 10px;font-size:.82rem;">
                <option>Cash</option><option>UPI</option><option>Card</option><option>Credit</option><option>Online</option>
              </select>
            </div>
            <div style="margin-top:12px;">
              <label class="form-lbl">Notes</label>
              <input id="bill-notes" class="form-ctrl" placeholder="Optional note‚Ä¶" style="margin-top:6px;"/>
            </div>
            <button class="btn btn-success btn-lg" style="width:100%;margin-top:20px;" onclick="finalizeBill()">‚úÖ Finalize &amp; Generate PDF</button>
            <button class="btn btn-ghost" style="width:100%;margin-top:10px;" onclick="clearBill()">üóë Clear Bill</button>
          </div>
        </div>
      </div>
    </section>

    <!-- INVENTORY -->
    <section id="page-inventory" class="page">
      <div class="page-hdr">
        <div><div class="page-title">Inventory <span class="txt-green">üì¶</span></div><div class="page-sub">Build your catalogue ‚Äî items auto-suggest while billing</div></div>
        <button class="btn btn-primary" onclick="toggleInvForm()">‚ûï Add Product</button>
      </div>
      <div class="card" id="inv-form" style="display:none;">
        <div class="card-ttl"><span class="pip green"></span>New Product</div>
        <div class="form-grid">
          <div class="form-group"><label class="form-lbl">Item Name <span class="req">*</span></label><input id="i-name" class="form-ctrl" placeholder="e.g. Basmati Rice 1kg"/></div>
          <div class="form-group"><label class="form-lbl">Category</label><input id="i-cat" class="form-ctrl" placeholder="e.g. Grains, Beverages‚Ä¶"/></div>
          <div class="form-group"><label class="form-lbl">Default Price ‚Çπ <span class="req">*</span></label><input id="i-price" class="form-ctrl" type="number" min="0" step="0.01" placeholder="0.00"/></div>
          <div class="form-group"><label class="form-lbl">Stock Quantity <span class="req">*</span></label><input id="i-stock" class="form-ctrl" type="number" min="0" value="0" placeholder="0"/></div>
          <div class="form-group"><label class="form-lbl">Low Stock Alert</label><input id="i-low" class="form-ctrl" type="number" min="0" value="10" placeholder="10"/></div>
          <div class="form-group"><label class="form-lbl">Default GST %</label><select id="i-gst" class="form-ctrl"><option value="0">0%</option><option value="5">5%</option><option value="12">12%</option><option value="18" selected>18%</option><option value="28">28%</option></select></div>
          <div class="form-group"><label class="form-lbl">Icon Emoji</label><input id="i-icon" class="form-ctrl" placeholder="üì¶" maxlength="4"/></div>
          <div class="form-group" style="align-self:flex-end;">
            <label class="form-lbl" style="opacity:0">‚Äî</label>
            <div style="display:flex;gap:8px;">
              <button class="btn btn-primary" onclick="saveInvItem()">üíæ Save</button>
              <button class="btn btn-ghost" onclick="toggleInvForm()">Cancel</button>
            </div>
          </div>
        </div>
      </div>
      <div class="card" style="padding:0;overflow:hidden;">
        <div class="tbl-wrap">
          <table>
            <thead><tr><th>#</th><th>Icon</th><th>Name</th><th>Category</th><th>Price</th><th>Stock</th><th>GST</th><th>Actions</th></tr></thead>
            <tbody id="inv-body"><tr><td colspan="8" class="empty-state"><span class="empty-icon">üì¶</span>No products yet ‚Äî add your first item above</td></tr></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- GST PORTAL -->
    <section id="page-gst" class="page">
      <div class="page-hdr">
        <div><div class="page-title">GST Portal <span class="txt-purple">üìä</span></div><div class="page-sub">Track input tax credit &amp; compute net GST payable</div></div>
        <button class="btn btn-amber" onclick="calcGST()">üîÑ Recalculate</button>
      </div>
      <div class="card">
        <div class="card-ttl"><span class="pip pink"></span>Purchases ‚Äî Input Tax Credit</div>
        <div id="gst-purch-list"></div>
        <div class="gst-purchase-row">
          <div class="form-group"><label class="form-lbl">Item / Vendor</label><input id="gp-name" class="form-ctrl" placeholder="e.g. Vegetable bulk purchase"/></div>
          <div class="form-group"><label class="form-lbl">Amount ‚Çπ</label><input id="gp-amt" class="form-ctrl" type="number" min="0" step="0.01" placeholder="0.00"/></div>
          <div class="form-group"><label class="form-lbl">GST Paid %</label><select id="gp-rate" class="form-ctrl"><option value="0">0%</option><option value="5">5%</option><option value="12">12%</option><option value="18" selected>18%</option><option value="28">28%</option></select></div>
          <div class="form-group" style="align-self:flex-end;"><button class="btn btn-primary" onclick="addGSTPurch()" style="height:42px;">‚ûï Add</button></div>
        </div>
      </div>
      <div class="gst-grid">
        <div class="card">
          <div class="card-ttl"><span class="pip amber"></span>GST Collected ‚Äî Sales</div>
          <div id="gst-sales-bd"><div class="empty-state" style="padding:16px 0;"><span class="empty-icon" style="font-size:1.8rem;">üìã</span>Generate bills to see GST data.</div></div>
        </div>
        <div class="gst-settle">
          <div class="gst-settle-ttl">‚ö° GST Settlement</div>
          <div class="gst-ln"><span>Output GST (Collected)</span><span class="pos" id="g-out">‚Çπ0.00</span></div>
          <div class="gst-ln"><span>Input GST (Purchases)</span><span class="neg" id="g-in">‚Çπ0.00</span></div>
          <div class="gst-ln"><span>Input Tax Credit</span><span class="neu" id="g-itc">‚Çπ0.00</span></div>
          <div class="gst-ln final"><span>Net Payable to Govt</span><span id="g-pay">‚Çπ0.00</span></div>
          <button class="btn btn-purple" style="width:100%;margin-top:20px;" onclick="exportGST()">üìÑ Export GST Report</button>
        </div>
      </div>
    </section>

    <!-- HISTORY -->
    <section id="page-history" class="page">
      <div class="page-hdr">
        <div><div class="page-title">Bill History <span class="txt-cyan">üïí</span></div><div class="page-sub">All generated bills ‚Äî searchable</div></div>
        <div class="page-actions">
          <input id="hist-srch" class="form-ctrl" style="max-width:230px;" placeholder="üîç Search by customer‚Ä¶" oninput="renderHistory()"/>
          <button class="btn btn-danger btn-sm" onclick="clearHistory()">üóë Clear All</button>
        </div>
      </div>
      <div id="hist-list" style="display:flex;flex-direction:column;gap:11px;"><div class="empty-state"><span class="empty-icon">üïí</span>No bills found.</div></div>
    </section>

    <!-- SETTINGS -->
    <section id="page-settings" class="page">
      <div class="page-hdr">
        <div><div class="page-title">Settings <span class="txt-cyan">‚öôÔ∏è</span></div><div class="page-sub">Manage shop configuration</div></div>
      </div>
      <div class="card" style="max-width:540px;">
        <div class="card-ttl"><span class="pip"></span>Shop Information</div>
        <div style="display:flex;flex-direction:column;gap:14px;">
          <div class="form-grid">
            <div class="form-group"><label class="form-lbl">Shop Name <span class="req">*</span></label><input id="cfg-name" class="form-ctrl"/></div>
            <div class="form-group"><label class="form-lbl">Business Type</label><select id="cfg-type" class="form-ctrl"><option>üõí Grocery Store</option><option>üçΩÔ∏è Restaurant</option><option>‚òï Caf√©</option><option>ü•ê Bakery</option><option>üíä Pharmacy</option><option>üì± Electronics</option><option>üëï Clothing</option><option>üè™ General Store</option><option>üçï Fast Food</option><option>üß¥ Cosmetics</option></select></div>
          </div>
          <div class="form-grid">
            <div class="form-group"><label class="form-lbl">GSTIN</label><input id="cfg-gst" class="form-ctrl" placeholder="22AAAAA0000A1Z5" maxlength="15"/></div>
            <div class="form-group"><label class="form-lbl">Phone</label><input id="cfg-phone" class="form-ctrl" placeholder="+91 XXXXX XXXXX"/></div>
          </div>
          <div class="form-group"><label class="form-lbl">Address</label><input id="cfg-addr" class="form-ctrl"/></div>
          <button class="btn btn-primary" style="align-self:flex-start;margin-top:6px;" onclick="saveSettings()">üíæ Save Settings</button>
        </div>
      </div>
      
      <div class="card" style="max-width:540px;">
        <div class="card-ttl"><span class="pip amber"></span>Data Management</div>
        <div style="display:flex;flex-direction:column;gap:12px;">
          <div style="display:flex;gap:10px;flex-wrap:wrap;">
            <button class="btn btn-primary" onclick="exportData()">üì• Export My Data</button>
            <button class="btn btn-ghost" onclick="document.getElementById('import-file').click()">üì§ Import Data</button>
            <input type="file" id="import-file" accept=".json" style="display:none;" onchange="importData(event)"/>
          </div>
          <p style="font-size:0.78rem;color:var(--t-muted);font-style:italic;">Export creates a backup file. Import restores data from backup.</p>
          <div class="hr" style="margin:8px 0;"></div>
          <button class="btn btn-danger" onclick="deleteAccount()">üóë Delete Account</button>
          <p style="font-size:0.78rem;color:var(--t-muted);font-style:italic;">‚ö†Ô∏è This will permanently delete your account and all data. Cannot be undone.</p>
        </div>
      </div>
      
      <div class="card" style="max-width:540px;">
        <div class="card-ttl"><span class="pip green"></span>Account Status</div>
        <div style="font-size:0.85rem;color:var(--t-muted);line-height:1.7;">
          <div style="display:flex;justify-content:space-between;padding:6px 0;">
            <span>Current User:</span>
            <span class="txt-cyan" style="font-weight:700;font-family:var(--font-display);" id="stat-user">‚Äî</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;">
            <span>Inventory Items:</span>
            <span class="txt-cyan" style="font-weight:700;" id="stat-inv-count">0</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;">
            <span>Total Bills:</span>
            <span class="txt-cyan" style="font-weight:700;" id="stat-bill-count">0</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;">
            <span>GST Purchases:</span>
            <span class="txt-cyan" style="font-weight:700;" id="stat-gst-count">0</span>
          </div>
          <div style="display:flex;justify-content:space-between;padding:6px 0;border-top:1px solid rgba(255,255,255,0.05);margin-top:8px;padding-top:12px;">
            <span>Last Saved:</span>
            <span class="txt-green" style="font-weight:700;font-family:var(--font-mono);font-size:0.75rem;" id="stat-last-saved">‚Äî</span>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- MODALS -->
<div id="cust-modal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>üôã Customer Details</h3>
    <p>Personalise the PDF receipt ‚Äî customer name required, rest optional</p>
    <div style="display:flex;flex-direction:column;gap:13px;">
      <div class="form-group"><label class="form-lbl">Customer Name <span class="req">*</span></label><input id="c-name" class="form-ctrl" placeholder="e.g. Ravi Kumar"/></div>
      <div class="form-grid" style="grid-template-columns:1fr 1fr;gap:12px;">
        <div class="form-group"><label class="form-lbl">Phone <span style="color:var(--t-dim)">(opt)</span></label><input id="c-phone" class="form-ctrl" type="tel" placeholder="+91 XXXXX‚Ä¶"/></div>
        <div class="form-group"><label class="form-lbl">Email <span style="color:var(--t-dim)">(opt)</span></label><input id="c-email" class="form-ctrl" type="email" placeholder="email@‚Ä¶"/></div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="genPDF(true)">‚è© Skip &amp; Generate</button>
      <button class="btn btn-primary" onclick="genPDF(false)">üìÑ Generate PDF</button>
    </div>
  </div>
</div>

<div id="cat-modal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal" style="max-width:560px;">
    <h3>üìã Item Catalog</h3>
    <p>Click any item to add it to the current bill</p>
    <input class="form-ctrl" id="cat-search" placeholder="üîç Filter items‚Ä¶" style="margin-bottom:14px;" oninput="renderCatalog(this.value)"/>
    <div class="catalog-grid" id="cat-grid"></div>
    <div class="modal-footer"><button class="btn btn-ghost" onclick="document.getElementById('cat-modal').style.display='none'">Close</button></div>
  </div>
</div>

<div id="shop-modal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>‚ö° Quick Shop Edit</h3>
    <p>Update your shop details quickly</p>
    <div style="display:flex;flex-direction:column;gap:13px;">
      <div class="form-group"><label class="form-lbl">Shop Name</label><input id="sm-name" class="form-ctrl"/></div>
      <div class="form-group"><label class="form-lbl">Business Type</label><select id="sm-type" class="form-ctrl"><option>üõí Grocery Store</option><option>üçΩÔ∏è Restaurant</option><option>‚òï Caf√©</option><option>ü•ê Bakery</option><option>üíä Pharmacy</option><option>üì± Electronics</option><option>üëï Clothing</option><option>üè™ General Store</option><option>üçï Fast Food</option><option>üß¥ Cosmetics</option></select></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="document.getElementById('shop-modal').style.display='none'">Cancel</button>
      <button class="btn btn-primary" onclick="saveShopModal()">üíæ Save</button>
    </div>
  </div>
</div>

<div id="restock-modal" class="modal-overlay" style="display:none;" onclick="if(event.target===this)this.style.display='none'">
  <div class="modal">
    <h3>üì¶ Restock Item</h3>
    <p>Add quantity to inventory stock</p>
    <div style="display:flex;flex-direction:column;gap:13px;">
      <div class="form-group">
        <label class="form-lbl">Item</label>
        <input id="rs-name" class="form-ctrl" readonly style="background:rgba(255,255,255,0.02);"/>
      </div>
      <div class="form-group">
        <label class="form-lbl">Current Stock</label>
        <input id="rs-current" class="form-ctrl" readonly style="background:rgba(255,255,255,0.02);"/>
      </div>
      <div class="form-group">
        <label class="form-lbl">Add Quantity <span class="req">*</span></label>
        <input id="rs-qty" class="form-ctrl" type="number" min="1" value="10" placeholder="10"/>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="document.getElementById('restock-modal').style.display='none'">Cancel</button>
      <button class="btn btn-success" onclick="doRestock()">‚úÖ Restock</button>
    </div>
  </div>
</div>

<div id="toast-wrap"></div>

<script>
'use strict';
let shop={name:'',type:'',gst:'',address:'',phone:''};
let billItems=[],billCounter=1,bills=[],inventory=[],gstPurchases=[];
let currentUser=null;

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MULTI-USER STORAGE SYSTEM
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const SESSION_KEY='neonbill_session';
const USERS_KEY='neonbill_users';

// Get all users from localStorage
function getAllUsers(){
  try{
    const raw=localStorage.getItem(USERS_KEY);
    return raw?JSON.parse(raw):{};
  }catch(e){
    console.error('Failed to load users:',e);
    return {};
  }
}

// Save user data to localStorage
function saveUserData(userId){
  try{
    const users=getAllUsers();
    users[userId]={
      shop,
      billCounter,
      bills,
      inventory,
      gstPurchases,
      lastLogin:new Date().toISOString()
    };
    localStorage.setItem(USERS_KEY,JSON.stringify(users));
  }catch(e){
    console.error('Failed to save user data:',e);
    toast('Failed to save data','err');
  }
}

// Save current session
function saveSession(){
  try{
    if(!currentUser)return;
    const sessionData={
      userId:currentUser,
      shop,
      billCounter,
      bills,
      inventory,
      gstPurchases,
      timestamp:new Date().toISOString()
    };
    sessionStorage.setItem(SESSION_KEY,JSON.stringify(sessionData));
    // Also save to localStorage for persistence
    saveUserData(currentUser);
  }catch(e){
    console.error('Failed to save session:',e);
  }
}

// Load session
function loadSession(){
  try{
    const raw=sessionStorage.getItem(SESSION_KEY);
    if(!raw)return false;
    const data=JSON.parse(raw);
    currentUser=data.userId;
    shop=data.shop||shop;
    billCounter=data.billCounter||1;
    bills=data.bills||[];
    inventory=data.inventory||[];
    gstPurchases=data.gstPurchases||[];
    return true;
  }catch(e){
    console.error('Failed to load session:',e);
    return false;
  }
}

// Load user data from localStorage
function loadUserData(userId){
  try{
    const users=getAllUsers();
    if(!users[userId])return false;
    const data=users[userId];
    currentUser=userId;
    shop=data.shop||shop;
    billCounter=data.billCounter||1;
    bills=data.bills||[];
    inventory=data.inventory||[];
    gstPurchases=data.gstPurchases||[];
    return true;
  }catch(e){
    console.error('Failed to load user:',e);
    return false;
  }
}

// Generate user ID from shop name
function generateUserId(shopName){
  return shopName.toLowerCase().replace(/[^a-z0-9]/g,'_');
}

// Login user
function loginUser(userId){
  const loaded=loadUserData(userId);
  if(loaded){
    saveSession();
    return true;
  }
  return false;
}

// Logout
function logout(){
  if(confirm('‚ö†Ô∏è Logout will end your current session.\n\nYour data is saved and you can login again anytime.\n\nContinue?')){
    // Save current data before logout
    saveSession();
    
    // Clear session
    sessionStorage.removeItem(SESSION_KEY);
    currentUser=null;
    
    toast('Logged out successfully. Redirecting...','ok');
    setTimeout(()=>location.reload(),1000);
  }
}

// Delete user account
function deleteAccount(){
  if(!currentUser)return;
  if(confirm('‚ö†Ô∏è This will PERMANENTLY delete your account and ALL data:\n\n‚Ä¢ Shop details\n‚Ä¢ Inventory\n‚Ä¢ Bills\n‚Ä¢ GST records\n\nThis cannot be undone!\n\nType "DELETE" in the next prompt to confirm.')){
    const confirmation=prompt('Type DELETE to confirm account deletion:');
    if(confirmation==='DELETE'){
      const users=getAllUsers();
      delete users[currentUser];
      localStorage.setItem(USERS_KEY,JSON.stringify(users));
      sessionStorage.removeItem(SESSION_KEY);
      toast('Account deleted successfully','ok');
      setTimeout(()=>location.reload(),1500);
    }else{
      toast('Account deletion cancelled','inf');
    }
  }
}

// Auto-save
function autoSave(){
  saveSession();
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SETUP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function doSetup(){
  const name=v('su-name').trim(),type=v('su-type');
  if(!name){toast('Enter your shop name','err');return;}
  if(!type){toast('Select a business type','err');return;}
  
  const userId=generateUserId(name);
  const users=getAllUsers();
  
  // Check if user exists
  if(users[userId]){
    // Login existing user
    const loaded=loginUser(userId);
    if(loaded){
      $('setup-overlay').style.display='none';
      syncShopUI();
      renderDashboard();
      renderInv();
      updateDL();
      renderGSTPurchases();
      calcGST();
      toast('Welcome back, '+name+'! üëã','ok');
    }
  }else{
    // Create new user
    shop={name,type,gst:v('su-gst').trim(),phone:v('su-phone').trim(),address:v('su-addr').trim()};
    currentUser=userId;
    $('setup-overlay').style.display='none';
    syncShopUI();
    loadSettings();
    autoSave();
    toast('Welcome, '+name+'! Account created üéâ','ok');
  }
}

function syncShopUI(){
  $('sb-name').textContent=shop.name||'‚Äî';
  $('sb-type').textContent=shop.type||'‚Äî';
  $('billing-shop-sub').textContent=shop.name+(shop.type?' ¬∑ '+shop.type:'');
  // Update logout button text
  if($('logout-user'))$('logout-user').textContent='üö™ Logout ('+shop.name+')';
}

// Check for existing session on page load
window.addEventListener('DOMContentLoaded',()=>{
  const sessionLoaded=loadSession();
  
  if(sessionLoaded&&shop.name){
    // Active session exists
    $('setup-overlay').style.display='none';
    syncShopUI();
    renderDashboard();
    renderInv();
    updateDL();
    renderGSTPurchases();
    calcGST();
    toast('Session restored ‚úÖ','ok');
  }else{
    // No active session - show login/signup screen
    showLoginScreen();
  }
});

function showLoginScreen(){
  const users=getAllUsers();
  const userList=Object.keys(users);
  
  if(userList.length>0){
    // Show user list for selection
    let html='<div style="margin-bottom:20px;"><div style="font-size:.85rem;color:var(--t-muted);margin-bottom:12px;text-align:center;">Select your account or create new one:</div>';
    html+='<div style="display:flex;flex-direction:column;gap:8px;">';
    userList.forEach(userId=>{
      const userData=users[userId];
      html+=`<button class="btn btn-ghost" style="width:100%;justify-content:flex-start;padding:12px 16px;" onclick="quickLogin('${userId}')">
        <span style="font-size:1.2rem;margin-right:10px;">üè™</span>
        <div style="text-align:left;">
          <div style="font-weight:700;color:var(--c-cyan);">${esc(userData.shop.name)}</div>
          <div style="font-size:.72rem;color:var(--t-muted);">${esc(userData.shop.type||'')}</div>
        </div>
      </button>`;
    });
    html+='</div><div class="hr" style="margin:16px 0;"></div>';
    html+='<div style="text-align:center;font-size:.82rem;color:var(--t-muted);">Or create a new shop account below ‚Üì</div></div>';
    
    // Insert before form
    const setupBox=document.querySelector('.setup-box');
    const heading=setupBox.querySelector('.setup-heading');
    if(heading&&!document.getElementById('user-list')){
      const div=document.createElement('div');
      div.id='user-list';
      div.innerHTML=html;
      heading.parentNode.insertBefore(div,heading.nextSibling);
      heading.textContent='Create New Shop Account';
    }
  }
}

function quickLogin(userId){
  const loaded=loginUser(userId);
  if(loaded){
    $('setup-overlay').style.display='none';
    syncShopUI();
    renderDashboard();
    renderInv();
    updateDL();
    renderGSTPurchases();
    calcGST();
    toast('Welcome back, '+shop.name+'! üëã','ok');
  }else{
    toast('Failed to load account','err');
  }
}

/* ROUTING */
function goTo(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  $('page-'+id).classList.add('active');
  document.querySelector('.nav-item[data-page="'+id+'"]').classList.add('active');
  if(id==='dashboard')renderDashboard();
  if(id==='gst'){renderGSTPurchases();calcGST();}
  if(id==='history')renderHistory();
  if(id==='settings')loadSettings();
}
document.addEventListener('keydown',e=>{
  if(e.altKey){
    const m={'1':'dashboard','2':'billing','3':'inventory','4':'gst','5':'history','6':'settings'};
    if(m[e.key]){e.preventDefault();goTo(m[e.key]);return;}
  }
  const bp=$('page-billing');
  if(bp&&bp.classList.contains('active')){
    if(e.key==='Escape'){clearBill();return;}
    if(e.key.toLowerCase()==='c'&&!e.target.matches('input,select,textarea')){e.preventDefault();openCatalog();return;}
    if(e.key==='Enter'&&!e.target.matches('input,select,textarea')){e.preventDefault();finalizeBill();return;}
  }
  if(e.key==='Enter'&&(e.target.id==='b-name'||e.target.id==='b-price'))addItem();
});

/* BILLING */
function addItem(){
  const name=v('b-name').trim(),qty=Math.max(0.001,parseFloat(v('b-qty'))||1),price=parseFloat(v('b-price')),gst=parseFloat(v('b-gst'))||0;
  if(!name){toast('Enter item name','err');$('b-name').focus();return;}
  if(isNaN(price)||price<0){toast('Enter valid price','err');$('b-price').focus();return;}
  
  // Check if item exists in inventory and has stock
  const invItem=inventory.find(i=>i.name.toLowerCase()===name.toLowerCase());
  if(invItem){
    if(invItem.stock<qty){
      toast(`Only ${invItem.stock} unit(s) available for ${name}`,'err');
      return;
    }
    invItem.stock-=qty;
    renderInv();checkStockAlerts();
    autoSave();
  }
  
  const ex=billItems.find(i=>i.name.toLowerCase()===name.toLowerCase()&&i.gst===gst);
  if(ex)ex.qty+=qty;else billItems.push({id:Date.now(),name,qty,price,gst,invId:invItem?invItem.id:null});
  renderBillTable();recalc();
  $('b-name').value='';$('b-qty').value='1';$('b-price').value='';$('b-name').focus();
}
function renderBillTable(){
  const tb=$('bill-body');
  if(!billItems.length){tb.innerHTML='<tr><td colspan="8" class="empty-state"><span class="empty-icon">üõí</span>Add items above to start billing</td></tr>';return;}
  tb.innerHTML=billItems.map((it,i)=>{
    const base=it.price*it.qty,gAmt=base*it.gst/100,tot=base+gAmt;
    return`<tr>
      <td class="mono" style="color:var(--t-muted)">${i+1}</td>
      <td class="td-bold">${esc(it.name)}</td>
      <td><div class="qty-ctrl"><button class="qty-btn" onclick="chQty(${it.id},-1)">‚àí</button><span class="qty-num">${fmt(it.qty)}</span><button class="qty-btn" onclick="chQty(${it.id},1)">+</button></div></td>
      <td class="mono">‚Çπ${it.price.toFixed(2)}</td>
      <td><span class="badge bdg-a">${it.gst}%</span></td>
      <td class="mono txt-amber">‚Çπ${gAmt.toFixed(2)}</td>
      <td class="mono txt-cyan" style="font-weight:700;">‚Çπ${tot.toFixed(2)}</td>
      <td><span class="td-del" onclick="remItem(${it.id})">‚úï</span></td>
    </tr>`;
  }).join('');
}
function chQty(id,d){
  const it=billItems.find(i=>i.id===id);if(!it)return;
  
  // If increasing quantity, check stock
  if(d>0&&it.invId){
    const invItem=inventory.find(i=>i.id===it.invId);
    if(invItem){
      if(invItem.stock<1){
        toast('Insufficient stock for '+it.name,'err');
        return;
      }
      invItem.stock--;
      renderInv();checkStockAlerts();
      autoSave();
    }
  }
  // If decreasing quantity, restore stock
  else if(d<0&&it.invId&&it.qty>1){
    const invItem=inventory.find(i=>i.id===it.invId);
    if(invItem){
      invItem.stock++;
      renderInv();
      autoSave();
    }
  }
  
  it.qty=Math.max(1,it.qty+d);
  renderBillTable();recalc();
}
function remItem(id){
  const it=billItems.find(i=>i.id===id);
  if(it&&it.invId){
    const invItem=inventory.find(i=>i.id===it.invId);
    if(invItem){
      invItem.stock+=it.qty;
      renderInv();
      autoSave();
    }
  }
  billItems=billItems.filter(i=>i.id!==id);
  renderBillTable();recalc();
}
function recalc(){
  let sub=0,gT=0;
  billItems.forEach(it=>{const b=it.price*it.qty;sub+=b;gT+=b*it.gst/100;});
  const dv=parseFloat(v('disc-val'))||0,dt=v('disc-type');
  let disc=dt==='pct'?sub*dv/100:dv;disc=Math.min(disc,sub+gT);
  const total=Math.max(0,sub+gT-disc);
  $('s-sub').textContent='‚Çπ'+sub.toFixed(2);
  $('s-gst').textContent='‚Çπ'+gT.toFixed(2);
  $('s-disc').textContent=disc.toFixed(2);
  $('s-total').textContent='‚Çπ'+total.toFixed(2);
}
function clearBill(){
  // Restore stock for all items in bill
  billItems.forEach(it=>{
    if(it.invId){
      const invItem=inventory.find(i=>i.id===it.invId);
      if(invItem){
        invItem.stock+=it.qty;
      }
    }
  });
  billItems=[];$('disc-val').value='0';$('bill-notes').value='';$('pay-mode').value='Cash';
  renderBillTable();recalc();renderInv();
  toast('Bill cleared','inf');
}
function finalizeBill(){
  if(!billItems.length){toast('Add at least one item','err');return;}
  $('c-name').value='';$('c-phone').value='';$('c-email').value='';
  $('cust-modal').style.display='flex';setTimeout(()=>$('c-name').focus(),120);
}

/* PDF */
function genPDF(skip){
  $('cust-modal').style.display='none';
  const cName=skip?'Walk-in Customer':(v('c-name').trim()||'Walk-in Customer');
  const cPhone=v('c-phone').trim(),cEmail=v('c-email').trim();
  const notes=v('bill-notes').trim(),pay=v('pay-mode');
  let sub=0,gT=0;
  billItems.forEach(it=>{const b=it.price*it.qty;sub+=b;gT+=b*it.gst/100;});
  const dv=parseFloat(v('disc-val'))||0,dt=v('disc-type');
  let disc=dt==='pct'?sub*dv/100:dv;disc=Math.min(disc,sub+gT);
  const total=Math.max(0,sub+gT-disc);
  const {jsPDF}=window.jspdf;
  const doc=new jsPDF({unit:'mm',format:'a4'});
  const W=doc.internal.pageSize.getWidth();
  let y=0;
  const bn=String(billCounter).padStart(4,'0');
  const now=new Date();
  const ds=now.toLocaleDateString('en-IN',{day:'2-digit',month:'short',year:'numeric'});
  const ts=now.toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'});
  /* Header */
  doc.setFillColor(5,7,15);doc.rect(0,0,W,48,'F');
  doc.setFillColor(0,229,255,50);doc.rect(0,46,W,2,'F');
  doc.setFont('helvetica','bold');doc.setFontSize(22);doc.setTextColor(0,229,255);
  doc.text('‚ö° '+shop.name,15,18);
  doc.setFontSize(8.5);doc.setFont('helvetica','normal');doc.setTextColor(90,106,138);
  if(shop.type)doc.text(shop.type,15,25);
  if(shop.address)doc.text(shop.address,15,31);
  if(shop.gst)doc.text('GSTIN: '+shop.gst,15,37);
  if(shop.phone)doc.text('Ph: '+shop.phone,15,43);
  doc.setFont('helvetica','bold');doc.setFontSize(11);doc.setTextColor(0,229,255);
  doc.text('BILL #'+bn,W-14,14,{align:'right'});
  doc.setFont('helvetica','normal');doc.setFontSize(8.5);doc.setTextColor(90,106,138);
  doc.text(ds+' ¬∑ '+ts,W-14,21,{align:'right'});
  doc.text('Payment: '+pay,W-14,28,{align:'right'});
  y=54;
  /* Customer */
  doc.setFillColor(11,16,34);doc.setDrawColor(0,229,255,70);doc.roundedRect(12,y,W-24,22,3,3,'FD');
  doc.setFontSize(7.5);doc.setTextColor(90,106,138);doc.text('BILL TO',18,y+8);
  doc.setFont('helvetica','bold');doc.setFontSize(11);doc.setTextColor(240,244,255);doc.text(cName,18,y+16);
  if(cPhone||cEmail){doc.setFontSize(8);doc.setFont('helvetica','normal');doc.setTextColor(90,106,138);doc.text([cPhone,cEmail].filter(Boolean).join('  ¬∑  '),18,y+22);}
  y+=30;
  /* Table */
  const cw=[10,68,18,28,22,26,28];
  const heads=['#','ITEM','QTY','UNIT ‚Çπ','GST%','GST ‚Çπ','TOTAL ‚Çπ'];
  let cx=12;
  doc.setFillColor(0,229,255,22);doc.rect(12,y,W-24,9,'F');
  doc.setFont('helvetica','bold');doc.setFontSize(7);doc.setTextColor(0,229,255);
  heads.forEach((h,i)=>{doc.text(h,cx+2,y+6);cx+=cw[i];});y+=9;
  doc.setFont('helvetica','normal');doc.setFontSize(9);
  billItems.forEach((it,idx)=>{
    if(y>250){doc.addPage();y=20;}
    const base=it.price*it.qty,gAmt=base*it.gst/100,tot=base+gAmt;
    doc.setFillColor(...(idx%2===0?[11,16,34]:[8,12,24]));doc.rect(12,y,W-24,9,'F');
    doc.setTextColor(200,212,240);cx=12;
    const cells=[String(idx+1),it.name.length>28?it.name.slice(0,26)+'‚Ä¶':it.name,fmt(it.qty),'Rs'+it.price.toFixed(2),it.gst+'%','Rs'+gAmt.toFixed(2),'Rs'+tot.toFixed(2)];
    cells.forEach((c,i)=>{if(i===6)doc.setTextColor(0,229,255);doc.text(c,cx+2,y+6);cx+=cw[i];if(i===6)doc.setTextColor(200,212,240);});
    y+=9;
  });
  y+=8;
  const px=W/2;
  doc.setDrawColor(30,50,80);doc.line(12,y,W-12,y);y+=8;
  [['Subtotal','Rs'+sub.toFixed(2),false],['GST','Rs'+gT.toFixed(2),'amber'],['Discount','- Rs'+disc.toFixed(2),'green']].forEach(([l,val,col])=>{
    doc.setFont('helvetica','normal');doc.setFontSize(9);doc.setTextColor(90,106,138);doc.text(l,px,y+5);
    doc.setFont('helvetica','bold');
    if(col==='amber')doc.setTextColor(255,171,0);else if(col==='green')doc.setTextColor(0,255,135);else doc.setTextColor(200,212,240);
    doc.text(val,W-14,y+5,{align:'right'});y+=9;
  });
  y+=4;
  doc.setFillColor(0,229,255,18);doc.roundedRect(px-4,y-2,W/2+4,14,3,3,'F');
  doc.setFont('helvetica','bold');doc.setFontSize(12);doc.setTextColor(0,229,255);
  doc.text('TOTAL',px,y+9);doc.text('Rs'+total.toFixed(2),W-14,y+9,{align:'right'});y+=18;
  if(notes){doc.setFontSize(8.5);doc.setFont('helvetica','italic');doc.setTextColor(90,106,138);doc.text('Note: '+notes,15,y);y+=8;}
  y=Math.max(y,265);
  doc.setDrawColor(0,229,255,50);doc.line(12,y,W-12,y);y+=6;
  doc.setFontSize(8);doc.setFont('helvetica','normal');doc.setTextColor(60,80,110);
  doc.text('Thank you for shopping with '+shop.name+' ‚ö°  Powered by NeonBill',W/2,y,{align:'center'});
  doc.save('Bill-'+bn+'-'+cName.replace(/\s+/g,'-')+'.pdf');
  bills.unshift({id:Date.now(),billNo:bn,date:now.toISOString(),customer:cName,phone:cPhone,email:cEmail,items:[...billItems],subtotal:sub,gstTotal:gT,discount:disc,total,payment:pay,notes});
  billCounter++;$('bill-num').textContent=String(billCounter).padStart(4,'0');
  autoSave();
  toast('Bill #'+bn+' saved for '+cName+' üéâ','ok');
  clearBill();renderDashboard();
}

/* INVENTORY */
function toggleInvForm(){const f=$('inv-form');f.style.display=f.style.display==='none'?'block':'none';if(f.style.display==='block')setTimeout(()=>$('i-name').focus(),80);}
function saveInvItem(){
  const name=v('i-name').trim(),price=parseFloat(v('i-price'));
  const stock=parseInt(v('i-stock'))||0;
  const lowStock=parseInt(v('i-low'))||10;
  if(!name){toast('Enter item name','err');return;}
  if(isNaN(price)||price<0){toast('Enter valid price','err');return;}
  inventory.push({
    id:Date.now(),
    name,
    cat:v('i-cat').trim(),
    price,
    stock,
    lowStock,
    gst:parseFloat(v('i-gst'))||0,
    icon:v('i-icon').trim()||'üì¶'
  });
  renderInv();updateDL();
  $('i-name').value='';$('i-cat').value='';$('i-price').value='';$('i-stock').value='';$('i-low').value='10';$('i-icon').value='';
  autoSave();
  toast(name+' added ‚úÖ','ok');
}
function renderInv(){
  const tb=$('inv-body');
  if(!inventory.length){tb.innerHTML='<tr><td colspan="8" class="empty-state"><span class="empty-icon">üì¶</span>No products yet</td></tr>';return;}
  tb.innerHTML=inventory.map((it,i)=>{
    let stockClass='stock-ok',stockIcon='‚úÖ';
    if(it.stock===0){stockClass='stock-out';stockIcon='‚ùå';}
    else if(it.stock<=it.lowStock){stockClass='stock-low';stockIcon='‚ö†Ô∏è';}
    return`
    <tr>
      <td class="mono" style="color:var(--t-muted)">${i+1}</td>
      <td style="font-size:1.4rem">${it.icon}</td>
      <td class="td-bold">${esc(it.name)}</td>
      <td><span class="badge bdg-c">${esc(it.cat||'‚Äî')}</span></td>
      <td class="mono txt-cyan">‚Çπ${it.price.toFixed(2)}</td>
      <td class="mono ${stockClass}">${stockIcon} ${it.stock}</td>
      <td><span class="badge bdg-a">${it.gst}%</span></td>
      <td style="display:flex;gap:7px;align-items:center;">
        <button class="btn btn-ghost btn-sm" onclick="addFromInv(${it.id})" ${it.stock===0?'disabled style="opacity:0.4;cursor:not-allowed;"':''}>‚ûï Bill</button>
        <button class="btn btn-sm" style="background:rgba(255,26,108,.1);color:var(--c-pink);border:1px solid rgba(255,26,108,.2);" onclick="delInv(${it.id})">‚úï</button>
        <button class="btn btn-ghost btn-sm" onclick="openRestockModal(${it.id})">üì¶ Restock</button>
      </td>
    </tr>`;
  }).join('');
}
function addFromInv(id){
  const it=inventory.find(x=>x.id===id);if(!it)return;
  if(it.stock===0){toast('Out of stock! Please restock first.','err');return;}
  const ex=billItems.find(b=>b.name===it.name&&b.gst===it.gst);
  if(ex){
    if(it.stock<1){toast('Insufficient stock for '+it.name,'err');return;}
    ex.qty++;it.stock--;
  }else{
    if(it.stock<1){toast('Insufficient stock for '+it.name,'err');return;}
    billItems.push({id:Date.now(),name:it.name,qty:1,price:it.price,gst:it.gst,invId:it.id});
    it.stock--;
  }
  renderBillTable();recalc();renderInv();checkStockAlerts();
  autoSave();
  goTo('billing');toast(it.name+' added to bill','ok');
}
function delInv(id){
  inventory=inventory.filter(i=>i.id!==id);
  renderInv();updateDL();
  autoSave();
}
function updateDL(){$('inv-dl').innerHTML=inventory.map(i=>`<option value="${esc(i.name)}">`).join('');}

document.addEventListener('DOMContentLoaded',()=>{
  $('b-name').addEventListener('input',function(){
    const m=inventory.find(i=>i.name.toLowerCase()===this.value.toLowerCase());
    if(m){
      $('b-price').value=m.price;
      $('b-gst').value=m.gst;
      // Show stock warning if low
      if(m.stock===0){
        toast('‚ö†Ô∏è '+m.name+' is out of stock!','err');
      }else if(m.stock<=m.lowStock){
        toast('‚ö†Ô∏è Only '+m.stock+' unit(s) left for '+m.name,'inf');
      }
    }
  });
});

/* CATALOG */
function openCatalog(){
  $('cat-search').value='';
  renderCatalog('');
  $('cat-modal').style.display='flex';
  setTimeout(()=>$('cat-search').focus(),100);
}
function renderCatalog(q){
  const list=inventory.filter(i=>!q||i.name.toLowerCase().includes(q.toLowerCase()));
  const g=$('cat-grid');
  if(!list.length){
    g.innerHTML='<p style="color:var(--t-muted);grid-column:1/-1;text-align:center;padding:20px;font-style:italic;">'+(inventory.length?'No matches.':'Add items in Inventory first.')+'</p>';
    return;
  }
  g.innerHTML=list.map(it=>`<div class="cat-item" onclick="catAdd(${it.id})"><div class="ci-icon">${it.icon}</div><div class="ci-name">${esc(it.name)}</div><div class="ci-price">‚Çπ${it.price.toFixed(2)}</div></div>`).join('');
}
function catAdd(id){addFromInv(id);renderBillTable();recalc();$('cat-modal').style.display='none';}

/* GST */
function addGSTPurch(){
  const name=v('gp-name').trim(),amt=parseFloat(v('gp-amt')),rate=parseFloat(v('gp-rate'))||0;
  if(!name||isNaN(amt)){toast('Enter item name and amount','err');return;}
  gstPurchases.push({id:Date.now(),name,amt,rate,paid:amt*rate/100});
  renderGSTPurchases();calcGST();$('gp-name').value='';$('gp-amt').value='';
  autoSave();
}
function renderGSTPurchases(){
  const el=$('gst-purch-list');
  if(!gstPurchases.length){el.innerHTML='';return;}
  el.innerHTML=`<div class="tbl-wrap" style="margin-bottom:14px;"><table>
    <thead><tr><th>#</th><th>Item / Vendor</th><th>Amount</th><th>GST Rate</th><th>GST Paid</th><th></th></tr></thead>
    <tbody>${gstPurchases.map((p,i)=>`<tr>
      <td class="mono" style="color:var(--t-muted)">${i+1}</td>
      <td class="td-bold">${esc(p.name)}</td>
      <td class="mono">‚Çπ${p.amt.toFixed(2)}</td>
      <td><span class="badge bdg-p">${p.rate}%</span></td>
      <td class="mono neg">‚Çπ${p.paid.toFixed(2)}</td>
      <td><span class="td-del" onclick="delGP(${p.id})">‚úï</span></td>
    </tr>`).join('')}</tbody></table></div>`;
}
function delGP(id){
  gstPurchases=gstPurchases.filter(p=>p.id!==id);
  renderGSTPurchases();calcGST();
  autoSave();
}
function calcGST(){
  const byRate={};let outTotal=0;
  bills.forEach(b=>b.items.forEach(it=>{const g=it.price*it.qty*it.gst/100;byRate[it.gst]=(byRate[it.gst]||0)+g;outTotal+=g;}));
  const bd=$('gst-sales-bd');
  if(!Object.keys(byRate).length){
    bd.innerHTML='<div class="empty-state" style="padding:16px 0;"><span class="empty-icon" style="font-size:1.8rem;">üìã</span>Generate bills to see GST data.</div>';
  }else{
    bd.innerHTML=Object.entries(byRate).sort((a,b)=>a[0]-b[0]).map(([r,a])=>`<div class="gst-ln"><span>GST @ ${r}%</span><span class="pos">‚Çπ${a.toFixed(2)}</span></div>`).join('')+
    `<div class="gst-ln" style="font-weight:800;border-top:1px solid rgba(255,255,255,.08);margin-top:8px;padding-top:10px;"><span>Total Output</span><span class="pos">‚Çπ${outTotal.toFixed(2)}</span></div>`;
  }
  const inpTotal=gstPurchases.reduce((s,p)=>s+p.paid,0);
  const payable=Math.max(0,outTotal-inpTotal);
  $('g-out').textContent='‚Çπ'+outTotal.toFixed(2);
  $('g-in').textContent='‚Çπ'+inpTotal.toFixed(2);
  $('g-itc').textContent='‚Çπ'+Math.min(inpTotal,outTotal).toFixed(2);
  const gp=$('g-pay');gp.textContent='‚Çπ'+payable.toFixed(2);gp.className=payable>0?'neg':'pos';
}
function exportGST(){
  const {jsPDF}=window.jspdf;const doc=new jsPDF({unit:'mm',format:'a4'});const W=doc.internal.pageSize.getWidth();
  doc.setFillColor(5,7,15);doc.rect(0,0,W,32,'F');
  doc.setFont('helvetica','bold');doc.setFontSize(16);doc.setTextColor(192,64,251);
  doc.text('GST SETTLEMENT REPORT ‚Äî '+shop.name,15,22);
  let y=42;
  doc.setFontSize(9);doc.setTextColor(90,106,138);doc.text('Generated: '+new Date().toLocaleString('en-IN'),15,y);y+=14;
  const byRate={};let outTotal=0;
  bills.forEach(b=>b.items.forEach(it=>{const g=it.price*it.qty*it.gst/100;byRate[it.gst]=(byRate[it.gst]||0)+g;outTotal+=g;}));
  doc.setFont('helvetica','bold');doc.setFontSize(11);doc.setTextColor(0,229,255);doc.text('OUTPUT TAX (Sales)',15,y);y+=8;
  doc.setFont('helvetica','normal');doc.setTextColor(200,212,240);
  Object.entries(byRate).forEach(([r,a])=>{doc.text('GST @ '+r+'%:',20,y);doc.text('Rs '+a.toFixed(2),W-20,y,{align:'right'});y+=8;});
  doc.setFont('helvetica','bold');doc.setTextColor(0,255,135);
  doc.text('Total Output:',20,y);doc.text('Rs '+outTotal.toFixed(2),W-20,y,{align:'right'});y+=14;
  let inpTotal=0;
  doc.setFont('helvetica','bold');doc.setFontSize(11);doc.setTextColor(255,26,108);doc.text('INPUT TAX (Purchases)',15,y);y+=8;
  doc.setFont('helvetica','normal');doc.setFontSize(9.5);doc.setTextColor(200,212,240);
  gstPurchases.forEach(p=>{doc.text(p.name.slice(0,35),20,y);doc.text('Rs '+p.paid.toFixed(2),W-20,y,{align:'right'});y+=7;inpTotal+=p.paid;});
  doc.setFont('helvetica','bold');doc.setTextColor(255,26,108);
  doc.text('Total Input (ITC):',20,y);doc.text('Rs '+inpTotal.toFixed(2),W-20,y,{align:'right'});y+=14;
  const payable=Math.max(0,outTotal-inpTotal);
  doc.setFillColor(192,64,251,20);doc.roundedRect(12,y-4,W-24,16,3,3,'F');
  doc.setFont('helvetica','bold');doc.setFontSize(12);doc.setTextColor(192,64,251);
  doc.text('NET GST PAYABLE:',15,y+7);doc.text('Rs '+payable.toFixed(2),W-14,y+7,{align:'right'});
  doc.save('GST-Report-'+shop.name.replace(/\s+/g,'-')+'.pdf');toast('GST Report exported!','ok');
}

/* HISTORY */
function renderHistory(){
  const q=v('hist-srch').toLowerCase();
  const el=$('hist-list');
  const filt=bills.filter(b=>b.customer.toLowerCase().includes(q)||b.billNo.includes(q));
  if(!filt.length){el.innerHTML='<div class="empty-state"><span class="empty-icon">üïí</span>No bills found.</div>';return;}
  el.innerHTML=filt.map(b=>{
    const d=new Date(b.date);
    return`<div class="hist-item">
      <div class="hist-meta"><h4>üßæ Bill #${b.billNo} ¬∑ ${esc(b.customer)}</h4><p>${b.items.length} item(s) ¬∑ ${b.payment}${b.phone?' ¬∑ üìû '+esc(b.phone):''}</p></div>
      <div class="hist-amt"><div class="amt">‚Çπ${b.total.toFixed(2)}</div><div class="dt">${d.toLocaleDateString('en-IN',{day:'2-digit',month:'short'})} ${d.toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'})}</div></div>
    </div>`;
  }).join('');
}
function clearHistory(){
  if(!bills.length){toast('No bills to clear','inf');return;}
  if(confirm('Clear all bill history?')){
    bills=[];
    renderHistory();renderDashboard();
    autoSave();
    toast('History cleared','inf');
  }
}

/* DASHBOARD */
function renderDashboard(){
  const today=new Date().toDateString();
  const tb=bills.filter(b=>new Date(b.date).toDateString()===today);
  $('st-bills').textContent=tb.length;
  $('st-rev').textContent='‚Çπ'+tb.reduce((s,b)=>s+b.total,0).toFixed(0);
  $('st-gst').textContent='‚Çπ'+tb.reduce((s,b)=>s+b.gstTotal,0).toFixed(0);
  $('st-disc').textContent='‚Çπ'+tb.reduce((s,b)=>s+b.discount,0).toFixed(0);
  
  // Stock alerts
  checkStockAlerts();
  
  const el=$('dash-recent');
  if(!bills.length){el.innerHTML='<div class="empty-state"><span class="empty-icon">üßæ</span>No bills yet. <a href="#" style="color:var(--c-cyan)" onclick="goTo(\'billing\')">Create your first ‚Üí</a></div>';return;}
  el.innerHTML='<div style="display:flex;flex-direction:column;gap:9px;">'+bills.slice(0,6).map(b=>{
    const d=new Date(b.date);
    return`<div class="hist-item" onclick="goTo('history')">
      <div class="hist-meta"><h4>Bill #${b.billNo} ¬∑ ${esc(b.customer)}</h4><p>${b.items.length} item(s) ¬∑ ${b.payment}</p></div>
      <div class="hist-amt"><div class="amt">‚Çπ${b.total.toFixed(2)}</div><div class="dt">${d.toLocaleDateString('en-IN',{day:'2-digit',month:'short'})} ${d.toLocaleTimeString('en-IN',{hour:'2-digit',minute:'2-digit'})}</div></div>
    </div>`;
  }).join('')+'</div>';
}

function checkStockAlerts(){
  const outOfStock=inventory.filter(i=>i.stock===0);
  const lowStock=inventory.filter(i=>i.stock>0&&i.stock<=i.lowStock);
  const el=$('stock-alerts');
  
  if(!outOfStock.length&&!lowStock.length){el.innerHTML='';return;}
  
  let html='';
  if(outOfStock.length>0){
    html+=`<div class="stock-notif">
      <div class="stock-notif-icon">‚ùå</div>
      <div class="stock-notif-content">
        <div class="stock-notif-title">Out of Stock (${outOfStock.length} item${outOfStock.length>1?'s':''})</div>
        <div class="stock-notif-msg">${outOfStock.map(i=>i.name).slice(0,3).join(', ')}${outOfStock.length>3?' and '+(outOfStock.length-3)+' more':''}</div>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="goTo('inventory')">Restock ‚Üí</button>
    </div>`;
  }
  if(lowStock.length>0){
    html+=`<div class="stock-notif" style="border-color:rgba(255,171,0,.25);background:linear-gradient(135deg,rgba(255,171,0,.08),rgba(255,171,0,.04));">
      <div class="stock-notif-icon">‚ö†Ô∏è</div>
      <div class="stock-notif-content">
        <div class="stock-notif-title" style="color:var(--c-amber)">Low Stock Alert (${lowStock.length} item${lowStock.length>1?'s':''})</div>
        <div class="stock-notif-msg">${lowStock.map(i=>i.name+' ('+i.stock+')').slice(0,3).join(', ')}${lowStock.length>3?' and '+(lowStock.length-3)+' more':''}</div>
      </div>
      <button class="btn btn-ghost btn-sm" onclick="goTo('inventory')">View ‚Üí</button>
    </div>`;
  }
  el.innerHTML=html;
}

/* SETTINGS */
function loadSettings(){
  $('cfg-name').value=shop.name||'';
  $('cfg-type').value=shop.type||'';
  $('cfg-gst').value=shop.gst||'';
  $('cfg-phone').value=shop.phone||'';
  $('cfg-addr').value=shop.address||'';
  
  // Update storage stats
  $('stat-user').textContent=shop.name||'‚Äî';
  $('stat-inv-count').textContent=inventory.length;
  $('stat-bill-count').textContent=bills.length;
  $('stat-gst-count').textContent=gstPurchases.length;
  
  try{
    const raw=sessionStorage.getItem(SESSION_KEY);
    if(raw){
      const data=JSON.parse(raw);
      if(data.timestamp){
        const d=new Date(data.timestamp);
        $('stat-last-saved').textContent=d.toLocaleDateString('en-IN',{day:'2-digit',month:'short',hour:'2-digit',minute:'2-digit'});
      }
    }
  }catch(e){}
}

function saveSettings(){
  shop.name=v('cfg-name').trim()||shop.name;shop.type=v('cfg-type');
  shop.gst=v('cfg-gst').trim();shop.phone=v('cfg-phone').trim();shop.address=v('cfg-addr').trim();
  syncShopUI();
  autoSave();
  toast('Settings saved ‚úÖ','ok');
  loadSettings();
}

function exportData(){
  try{
    const data={
      userId:currentUser,
      shop,billCounter,bills,inventory,gstPurchases,
      exportDate:new Date().toISOString(),
      version:'2.0'
    };
    const json=JSON.stringify(data,null,2);
    const blob=new Blob([json],{type:'application/json'});
    const url=URL.createObjectURL(blob);
    const a=document.createElement('a');
    a.href=url;
    a.download='neonbill-'+shop.name.replace(/\s+/g,'-')+'-'+new Date().toISOString().split('T')[0]+'.json';
    a.click();
    URL.revokeObjectURL(url);
    toast('Data exported successfully ‚úÖ','ok');
  }catch(e){
    toast('Export failed: '+e.message,'err');
  }
}

function importData(e){
  const file=e.target.files[0];
  if(!file)return;
  const reader=new FileReader();
  reader.onload=function(ev){
    try{
      const data=JSON.parse(ev.target.result);
      if(confirm('‚ö†Ô∏è Import will replace ALL current data for this account. Continue?')){
        shop=data.shop||shop;
        billCounter=data.billCounter||1;
        bills=data.bills||[];
        inventory=data.inventory||[];
        gstPurchases=data.gstPurchases||[];
        autoSave();
        syncShopUI();
        renderDashboard();
        renderInv();
        updateDL();
        renderGSTPurchases();
        calcGST();
        loadSettings();
        toast('Data imported successfully ‚úÖ','ok');
      }
    }catch(err){
      toast('Import failed: Invalid file format','err');
    }
  };
  reader.readAsText(file);
  e.target.value='';
}

function openShopModal(){$('sm-name').value=shop.name;$('sm-type').value=shop.type;$('shop-modal').style.display='flex';}
function saveShopModal(){
  shop.name=$('sm-name').value.trim()||shop.name;shop.type=$('sm-type').value;
  syncShopUI();$('shop-modal').style.display='none';
  autoSave();
  toast('Shop updated ‚úÖ','ok');
}

/* RESTOCK */
let restockItemId=null;
function openRestockModal(id){
  const it=inventory.find(i=>i.id===id);
  if(!it)return;
  restockItemId=id;
  $('rs-name').value=it.name;
  $('rs-current').value=it.stock+' units';
  $('rs-qty').value='10';
  $('restock-modal').style.display='flex';
  setTimeout(()=>$('rs-qty').focus(),100);
}
function doRestock(){
  const qty=parseInt(v('rs-qty'))||0;
  if(qty<=0){toast('Enter valid quantity','err');return;}
  const it=inventory.find(i=>i.id===restockItemId);
  if(!it)return;
  it.stock+=qty;
  renderInv();checkStockAlerts();
  $('restock-modal').style.display='none';
  autoSave();
  toast(it.name+' restocked with '+qty+' units ‚úÖ','ok');
  restockItemId=null;
}

/* TOAST */
function toast(msg,type='inf'){
  const icons={ok:'‚úÖ',err:'‚ùå',inf:'‚ÑπÔ∏è'};
  const c=$('toast-wrap');const t=document.createElement('div');
  t.className='toast '+type;t.innerHTML=`<span>${icons[type]}</span><span>${msg}</span>`;
  c.appendChild(t);
  setTimeout(()=>{t.style.transition='all .3s';t.style.opacity='0';t.style.transform='translateX(40px)';setTimeout(()=>t.remove(),300);},3200);
}

/* UTILS */
function $(id){return document.getElementById(id);}
function v(id){const el=$(id);return el?el.value:'';}
function esc(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');}
function fmt(n){return Number.isInteger(n)?String(n):parseFloat(n.toFixed(2)).toString();}
</script>
</body>
</html>